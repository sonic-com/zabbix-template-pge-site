<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>6.4</version>
    <template_groups>
        <template_group>
            <uuid>7df96b18c230490a9a0a9e2307226338</uuid>
            <name>Templates</name>
        </template_group>
        <template_group>
            <uuid>c1d5e259a4e74b0f8d7c1cad2419826a</uuid>
            <name>Templates/Data Center</name>
        </template_group>
        <template_group>
            <uuid>3dcd5bbe90534f9e8eb5c2d53756af63</uuid>
            <name>Templates/Power</name>
        </template_group>
    </template_groups>
    <templates>
        <template>
            <uuid>3f2a0f8fc4f143899a26176f10f6c5f7</uuid>
            <template>PGE Power Outages at Site via HTTP REST API</template>
            <name>PGE Power Outages at Site via HTTP REST API</name>
            <description>User-visible information is at https://pgealerts.alerts.pge.com/
API is at https://ewapi.cloudapi.pge.com

To find a prem_id, &quot;inspect&quot; network activity in firefox while loading outage status, and look at either the prem_id field of the url or the prem_id returned in the JSON body.</description>
            <groups>
                <group>
                    <name>Templates</name>
                </group>
                <group>
                    <name>Templates/Data Center</name>
                </group>
                <group>
                    <name>Templates/Power</name>
                </group>
            </groups>
            <items>
                <item>
                    <uuid>0d0ace87bf764bbf98f1e9498925f208</uuid>
                    <name>PGE Power Outage Current Cause</name>
                    <type>DEPENDENT</type>
                    <key>pge.outage.current_outage.cause</key>
                    <delay>0</delay>
                    <history>14d</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.[0].sp_meter_transformer_details.[0].current_outage.outage_cause</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pge.outage.raw</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>scope</tag>
                            <value>current</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>6cbae661bc76456a8450aaccd215eafe</uuid>
                    <name>PGE Power Outage Current Crew Current Status</name>
                    <type>DEPENDENT</type>
                    <key>pge.outage.current_outage.crew_current_status</key>
                    <delay>0</delay>
                    <history>14d</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.[0].sp_meter_transformer_details.[0].current_outage.crew_current_status</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pge.outage.raw</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>scope</tag>
                            <value>current</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>ebc73d7a254e47c8aef35a7541eaedea</uuid>
                    <name>PGE Power Outage Current Estimated Customers</name>
                    <type>DEPENDENT</type>
                    <key>pge.outage.current_outage.est_customers</key>
                    <delay>0</delay>
                    <history>14d</history>
                    <units>customers</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.[0].sp_meter_transformer_details.[0].current_outage.est_customers</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pge.outage.raw</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>scope</tag>
                            <value>current</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>eb9aa94e3c6443fca29ff6a7ed21d5b1</uuid>
                    <name>PGE Power Outage Current Start</name>
                    <type>DEPENDENT</type>
                    <key>pge.outage.current_outage.outage_start</key>
                    <delay>0</delay>
                    <history>14d</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.[0].sp_meter_transformer_details.[0].current_outage.outage_start</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pge.outage.raw</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>scope</tag>
                            <value>current</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>cc2355ccb96c4e718a065bba1ecf607b</uuid>
                    <name>PGE Power Outage Current Details</name>
                    <type>DEPENDENT</type>
                    <key>pge.outage.current_outage.raw</key>
                    <delay>0</delay>
                    <history>14d</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.[0].sp_meter_transformer_details.[0].current_outage</parameter>
                            </parameters>
                            <error_handler>DISCARD_VALUE</error_handler>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <parameters>
                                <parameter>&quot;,&quot;</parameter>
                                <parameter>&quot;,\n&quot;</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <parameters>
                                <parameter>{&quot;</parameter>
                                <parameter>{\n&quot;</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <parameters>
                                <parameter>&quot;}</parameter>
                                <parameter>&quot;\n}</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pge.outage.raw</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>scope</tag>
                            <value>current</value>
                        </tag>
                    </tags>
                    <triggers>
                        <trigger>
                            <uuid>0e78094abc794521aea277028b30e617</uuid>
                            <expression>last(/PGE Power Outages at Site via HTTP REST API/pge.outage.current_outage.raw,#1)&lt;&gt;&quot;{}&quot;</expression>
                            <name>PGE Power Out Currently Details</name>
                            <opdata>{ITEM.LASTVALUE1}</opdata>
                            <priority>HIGH</priority>
                            <description>PGE shows an outage for this site currently.

Details:
{ITEM.LASTVALUE1}</description>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <uuid>c5de11970979403e96b9ce8a562aaead</uuid>
                    <name>PGE Power Outage Current Boolean</name>
                    <type>DEPENDENT</type>
                    <key>pge.outage.has_newer_nonsync_outage</key>
                    <delay>0</delay>
                    <history>30d</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.[0].sp_meter_transformer_details.[0].has_newer_nonsync_outage</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pge.outage.raw</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>scope</tag>
                            <value>current</value>
                        </tag>
                    </tags>
                    <triggers>
                        <trigger>
                            <uuid>aba88f3543444a91bd245aef30dccd14</uuid>
                            <expression>last(/PGE Power Outages at Site via HTTP REST API/pge.outage.has_newer_nonsync_outage,#1)=&quot;true&quot;</expression>
                            <name>PGE Power Out Currently</name>
                            <priority>HIGH</priority>
                            <description>https://pgealerts.alerts.pge.com/outage-status/ shows an active outage for this site</description>
                            <dependencies>
                                <dependency>
                                    <name>PGE Power Out Currently Details</name>
                                    <expression>last(/PGE Power Outages at Site via HTTP REST API/pge.outage.current_outage.raw,#1)&lt;&gt;&quot;{}&quot;</expression>
                                </dependency>
                            </dependencies>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <uuid>3acbdff2cd46497799dddcd70f04f33c</uuid>
                    <name>PGE Power Outage Recent Cause</name>
                    <type>DEPENDENT</type>
                    <key>pge.outage.most_recent_outage.cause</key>
                    <delay>0</delay>
                    <history>14d</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.[0].sp_meter_transformer_details.[0].most_recent_outage.outage_cause</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pge.outage.raw</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>scope</tag>
                            <value>historical</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>e4d4095214b24bf4ae68cb9f974801fe</uuid>
                    <name>PGE Power Outage Recent Crew Current Status</name>
                    <type>DEPENDENT</type>
                    <key>pge.outage.most_recent_outage.crew_current_status</key>
                    <delay>0</delay>
                    <history>14d</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.[0].sp_meter_transformer_details.[0].most_recent_outage.crew_current_status</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pge.outage.raw</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>scope</tag>
                            <value>historical</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>23ab31ae525242d2b9902792e9fcc724</uuid>
                    <name>PGE Power Outage Recent Estimated Customers</name>
                    <type>DEPENDENT</type>
                    <key>pge.outage.most_recent_outage.est_customers</key>
                    <delay>0</delay>
                    <history>14d</history>
                    <units>customers</units>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.[0].sp_meter_transformer_details.[0].most_recent_outage.est_customers</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pge.outage.raw</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>scope</tag>
                            <value>historical</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>e131eb4cc35847fda7c4f585061536e7</uuid>
                    <name>PGE Power Outage Recent Start</name>
                    <type>DEPENDENT</type>
                    <key>pge.outage.most_recent_outage.outage_start</key>
                    <delay>0</delay>
                    <history>14d</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.[0].sp_meter_transformer_details.[0].most_recent_outage.outage_start</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pge.outage.raw</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>scope</tag>
                            <value>historical</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>265ea9f615294aafafc250da7fc2f19e</uuid>
                    <name>PGE Power Outage Recent Details</name>
                    <type>DEPENDENT</type>
                    <key>pge.outage.most_recent_outage.raw</key>
                    <delay>0</delay>
                    <history>14d</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.[0].sp_meter_transformer_details.[0].most_recent_outage</parameter>
                            </parameters>
                            <error_handler>DISCARD_VALUE</error_handler>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <parameters>
                                <parameter>&quot;,&quot;</parameter>
                                <parameter>&quot;,\n&quot;</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <parameters>
                                <parameter>{&quot;</parameter>
                                <parameter>{\n&quot;</parameter>
                            </parameters>
                        </step>
                        <step>
                            <type>STR_REPLACE</type>
                            <parameters>
                                <parameter>&quot;}</parameter>
                                <parameter>&quot;\n}</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pge.outage.raw</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>scope</tag>
                            <value>historical</value>
                        </tag>
                    </tags>
                    <triggers>
                        <trigger>
                            <uuid>bb0c534ec00f4687971910ddf0b03204</uuid>
                            <expression>last(/PGE Power Outages at Site via HTTP REST API/pge.outage.most_recent_outage.raw,#1)&lt;&gt;&quot;{}&quot;</expression>
                            <name>PGE Power Out Recently Details</name>
                            <opdata>{ITEM.LASTVALUE1}</opdata>
                            <priority>WARNING</priority>
                            <description>PGE shows a recent outage for this site currently.

Details:
{ITEM.LASTVALUE1}</description>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <uuid>effbbbc8b2ff416584071d327f63cfa7</uuid>
                    <name>PGE Power Outage Power Restored At</name>
                    <type>DEPENDENT</type>
                    <key>pge.outage.power_restored_at</key>
                    <delay>0</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.[0].sp_meter_transformer_details.[0].power_restored_at</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pge.outage.raw</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>scope</tag>
                            <value>current</value>
                        </tag>
                        <tag>
                            <tag>scope</tag>
                            <value>historical</value>
                        </tag>
                    </tags>
                </item>
                <item>
                    <uuid>76bac1c2ebd742cdbfadc6fcb76ad90d</uuid>
                    <name>PGE Power Restored Recently Boolean</name>
                    <type>DEPENDENT</type>
                    <key>pge.outage.power_restored_recently</key>
                    <delay>0</delay>
                    <history>30d</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <preprocessing>
                        <step>
                            <type>JSONPATH</type>
                            <parameters>
                                <parameter>$.[0].sp_meter_transformer_details.[0].power_restored_recently</parameter>
                            </parameters>
                        </step>
                    </preprocessing>
                    <master_item>
                        <key>pge.outage.raw</key>
                    </master_item>
                    <tags>
                        <tag>
                            <tag>scope</tag>
                            <value>historical</value>
                        </tag>
                    </tags>
                    <triggers>
                        <trigger>
                            <uuid>53a401aa64424a0995ed108f17bb7588</uuid>
                            <expression>last(/PGE Power Outages at Site via HTTP REST API/pge.outage.power_restored_recently,#1)=&quot;true&quot;</expression>
                            <name>PGE Power Restored Recently</name>
                            <priority>WARNING</priority>
                            <description>PGE shows a recent outage for this site.</description>
                            <dependencies>
                                <dependency>
                                    <name>PGE Power Out Recently Details</name>
                                    <expression>last(/PGE Power Outages at Site via HTTP REST API/pge.outage.most_recent_outage.raw,#1)&lt;&gt;&quot;{}&quot;</expression>
                                </dependency>
                            </dependencies>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <uuid>80927b7cf4414f97a62f8113478ac7f4</uuid>
                    <name>PGE Outage Raw JSON</name>
                    <type>HTTP_AGENT</type>
                    <key>pge.outage.raw</key>
                    <delay>5m</delay>
                    <history>0</history>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <url>https://ewapi.cloudapi.pge.com/single-address-outages</url>
                    <query_fields>
                        <query_field>
                            <name>prem_id</name>
                            <value>{$PGE.POWEROUTAGE.PREMID}</value>
                        </query_field>
                    </query_fields>
                    <headers>
                        <header>
                            <name>User-Agent</name>
                            <value>zabbix/6.4</value>
                        </header>
                        <header>
                            <name>Accept</name>
                            <value>*/*</value>
                        </header>
                    </headers>
                    <tags>
                        <tag>
                            <tag>component</tag>
                            <value>raw</value>
                        </tag>
                    </tags>
                </item>
            </items>
            <tags>
                <tag>
                    <tag>class</tag>
                    <value>power</value>
                </tag>
                <tag>
                    <tag>scope</tag>
                    <value>site</value>
                </tag>
                <tag>
                    <tag>target</tag>
                    <value>pge</value>
                </tag>
            </tags>
            <macros>
                <macro>
                    <macro>{$PGE.POWEROUTAGE.PREMID}</macro>
                    <value>8386513241</value>
                </macro>
            </macros>
        </template>
    </templates>
</zabbix_export>
